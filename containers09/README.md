# Лабораторная работа: Оптимизация Docker-образов

## Цель работы
Целью работы является знакомство с методами оптимизации Docker-образов.

## Задание
Сравнить различные методы оптимизации образов:
1. Удаление неиспользуемых зависимостей и временных файлов.
2. Уменьшение количества слоев.
3. Использование минимального базового образа.
4. Перепаковка образа.
5. Комбинирование всех методов.

## Выполнение работы

### Подготовка
1. Установлен Docker.
2. Создан репозиторий `containers09` и склонирован на локальный компьютер.
3. Создана папка `site` с файлами сайта (`index.html`, `style.css`, `script.js`).

### Шаги выполнения
1. **Исходный образ (`mynginx:raw`)**
   - Создан `Dockerfile.raw` на основе `ubuntu:latest`.
   - Сборка: `docker image build -t mynginx:raw -f Dockerfile.raw .`

2. **Удаление временных файлов (`mynginx:clean`)**
   - Создан `Dockerfile.clean` с очисткой кэша (`apt-get clean`).
   - Сборка: `docker image build -t mynginx:clean -f Dockerfile.clean .`

3. **Уменьшение количества слоев (`mynginx:few`)**
   - Создан `Dockerfile.few`, где команды объединены в один слой.
   - Сборка: `docker image build -t mynginx:few -f Dockerfile.few .`

4. **Минимальный базовый образ (`mynginx:alpine`)**
   - Создан `Dockerfile.alpine` на основе `alpine:latest`.
   - Сборка: `docker image build -t mynginx:alpine -f Dockerfile.alpine .`

5. **Перепаковка образа (`mynginx:repack`)**
   - Перепаковка: 
     ```bash
     docker container create --name mynginx mynginx:raw
     docker container export mynginx | docker image import - mynginx:repack
     docker container rm mynginx
6. **Комбинирование всех методов (`mynginx:min`)**
    - Создан Dockerfile.min с использованием alpine, объединением слоев и очисткой кэша.
    - Сборка и перепаковка:
    ```bash
    docker image build -t mynginx:minx -f Dockerfile.min .
    docker container create --name mynginx mynginx:minx
    docker container export mynginx | docker image import - mynginx:min
    docker container rm mynginx

### Ответы на вопросы
1. Какой метод оптимизации образов вы считаете наиболее эффективным? 

Наиболее эффективный метод — использование минимального базового образа (alpine). Он значительно уменьшает размер образа (с ~250 MB до ~20 MB) за счет компактного базового окружения.

2. Почему очистка кэша пакетов в отдельном слое не уменьшает размер образа? 

Docker сохраняет каждый слой образа независимо. Если очистка кэша выполняется в отдельном слое, предыдущие слои, содержащие кэш, остаются в образе. Для уменьшения размера очистку нужно выполнять в том же слое, где устанавливаются пакеты.

3. Что такое перепаковка образа? 

Перепаковка — это процесс экспорта файловой системы контейнера и импорта ее как новый образ. Это удаляет промежуточные слои, создавая плоский образ, что может уменьшить размер, но теряет историю сборки.

### Выводы
 - Наиболее эффективный метод оптимизации — использование минимального базового образа (alpine).
 - Комбинирование методов (минимальный образ, объединение слоев, очистка кэша, перепаковка) дает наименьший размер образа.
 - Оптимизация требует баланса между размером образа и удобством поддержки.